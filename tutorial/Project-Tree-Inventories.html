<html lang="en">
<head>
<title>Project Tree Inventories - arch Meets hello-world</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="arch Meets hello-world">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Getting-Started.html#Getting-Started" title="Getting Started">
<link rel="prev" href="Starting-a-New-Source-Tree.html#Starting-a-New-Source-Tree" title="Starting a New Source Tree">
<link rel="next" href="Inventory-Ids-for-Source.html#Inventory-Ids-for-Source" title="Inventory Ids for Source">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Project-Tree-Inventories"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Inventory-Ids-for-Source.html#Inventory-Ids-for-Source">Inventory Ids for Source</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Starting-a-New-Source-Tree.html#Starting-a-New-Source-Tree">Starting a New Source Tree</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Getting-Started.html#Getting-Started">Getting Started</a>
<hr>
</div>

<h3 class="section">3.6 Project Tree Inventories</h3>

<p><strong>Caution: Steep Learning Curve:</strong>  The concepts and commands introduced
in this chapter are likely to be unfamiliar to you, even if you have
used other revision control systems.   They're really quite simple
once you get over the initial learning hurdle &ndash; and after that
they're very useful.

<h4 class="subsection">3.6.1 The Name-based inventory Concept</h4>

<p>In a project tree, some of the files and directories are "part of
the source" &ndash; they are of interest to <code>arch</code>.  Other files and
directories may be scratch files, editor back-up files, and temporary
or intermediate files generated by programs.  Those other files should
be ignored or treated specially by most <code>arch</code> commands.

   <p>This chapter discusses how <code>arch</code> recognizes which files to pay
attention to, and which to ignore.

   </ul>

<h4 class="subsection">3.6.2 The inventory Command</h4>

<p><a name="index-inventory-25"></a>

   <p>The command <code>tla inventory --names --source</code> is used to print a list
of source files as determined by the naming conventions.  It has many
options, including options to print other kinds of file lists (such as
a list of all editor backup files, or a list of all files which are
not source).

   <p>Let's suppose that after some editing, our source tree looks like
this:

<pre class="example">             % ls
             hw.c            hw.c.~1~        main.c          {arch}
</pre>
   <p>The file <code>hw.c.~1~</code> is an editor backup file. <code>tla</code> knows that
and omits that file from the source inventory:

<pre class="example">             % tla inventory --names --source
             ./hw.c
             ./main.c
</pre>
   <p><code>tla</code> can give you other lists besides lists of source:

<pre class="example">             % tla inventory --names --backups
             ./hw.c.~1~
</pre>
   <h4 class="subsection">3.6.3 The arch Naming Conventions</h4>

<p><a name="index-naming-conventions-26"></a>

   <p>This section describes the default naming conventions used by <code>arch</code>
to pick out source files from other kinds of files.  A later chapter
describes how to customize these conventions for a partiuclar tree
(see <a href="Customizing-the-inventory-Naming-Conventions.html#Customizing-the-inventory-Naming-Conventions">Customizing the inventory Naming Conventions</a>).

   <p>The naming conventions are based on several categories of files:

<pre class="example">
             . and ..                These are simply ignored by arch

             excluded                Excluded files are normally omitted
                                     from a listing, but if the `--all'
                                     flag is passed to `inventory',
                                     then these files are put into
                                     one of the categories below and
                                     included in the listing.

             source                  These are apparent source files

             precious                These are non-source files that
                                     should not be automatically deleted

             junk                    These are non-source files that
                                     may be automatically deleted

             backups                 These are non-source files that
                                     may be automatically deleted, but
                                     any program that deletes them should
                                     treat them as editor backup files
                                     (e.g., keep the oldest and newest
                                     of them)

             unrecognized            These are files that arch doesn't
                                     know how to classify -- they fit
                                     none of the naming conventions or
                                     that have names that appear to
                                     be "suspicious".

</pre>
   <p>The algorithm for classifying files by name has several rules.  For
each file name, each of these rules is checked in the order listed
here until the first rule is reached that classifies the file.

   <p><strong>Exclude Dot Files</strong>  The special files <code>.</code> and <code>..</code> are always
excluded from inventory listings.

   <p><strong>Non-portable Names are Unrecognized</strong>  File names containing
whitespace, non-printing characters, or a "globbing character" are
always classified as <code>unrecognized</code>.   The globbing characters
are:

<pre class="example">             ? [ ] * \
</pre>
   <p><strong>Excluded File Test</strong> If the <code>--all</code> flag is <em>not</em> given to
<code>inventory</code>, the file names matching the pattern for excluded files
are dropped from the listing.  If the name of a directory is excluded,
the entire contents of that directory are skipped.  By default, the
pattern for excluded files matches control files created by <code>arch</code>
itself:

<pre class="example">             ^(.arch-ids|\{arch\})$
</pre>
   <p><strong>Junk File Test</strong> All file names reaching this step that begin with two
commas (<code>,,</code>) are classified as <code>junk</code>.  Temporary files created by
<code>arch</code> itself begin with two commas.  In addition, any file name
matching the junk pattern are classified by <code>junk</code>.  By default, that
pattern matches any name beginning with (at least) one comma:

<pre class="example">             ^,.*$
</pre>
   <p>Incidentally, that default pattern gives rise to a handy trick.  If you
need to create a scratch file in a source tree, give it a name that
begins with a single comma.

   <p><strong>Backup File Test</strong> By default, a backup file is any file that reaches this
step and matches one of the patterns:

<pre class="example">             ^.*(~|\.~[0-9]+~)$
             ^.*\.bak|\.orig|\.rej|\.original|\.modified|\.reject)$
</pre>
   <p><strong>Precious File Test</strong> By default, a precious file is any that reaches this
step and matches one of the patterns:

<pre class="example">          ^\+.*$
          ^(\.gdbinit|\.#ckpts-lock)$
          ^(=build\.*|=install\.*)$
          ^(CVS|CVS\.adm|RCS|RCSLOG|SCCS|TAGS)$
</pre>
   <p><strong>Suspicious File Test (Unrecognized)</strong> Some file names reaching this step
are explicitly treated as <code>unrecognized</code> on the presumption that they
should probably not be present in a source tree.  By default, names
ending with any of these extensions are treated as <code>unrecognized</code>:

<pre class="example">             .o
             .a
             .so
             .core
</pre>
   <p>In addition, the filename <code>core</code> is (by default) treated as
<code>unrecognized</code>).

   <p><strong>Source File Test</strong> Files reaching this step are compared to the pattern
for source files.   The default pattern is shown below.  You should
note that this pattern overlaps that for <code>excluded</code> files given
above.  If the <code>--all</code> flag is given to inventory, the <code>excluded</code>
pattern isn't used, and files that would match it instead "fall
through" to later steps of this algorithm.

<pre class="example">             ^([_=a-zA-Z0-9].*|\.arch-ids|\{arch\}|\.arch-project-tree)$
</pre>
   <p>In other words, by default, the <code>arch</code> control files and directories
are source (if not excluded).  Files beginning with letters, numbers,
underscore, or an equal sign are source.

   <p><strong>Unrecognized Files</strong> Any left-over file name reaching this step is
treated as <code>unrecognized</code>.

<h4 class="subsection">3.6.4 Naming Conventions Illustrated</h4>

<p>Using our example, we can illustrate some of the naming conventions.

   <p>Recall that our project tree looks like this:

<pre class="example">             % ls
             hw.c            hw.c.~1~        main.c          {arch}
</pre>
   <p>So the ordinary source listing is:

<pre class="example">             % tla inventory --names --source
             ./hw.c
             ./main.c
</pre>
   <p>And all of the source files (none excluded from the list) is:

<pre class="example">             % tla inventory --names --source --all
             ./hw.c
             ./main.c
             ./{arch}/.arch-project-tree
             ./{arch}/=tagging-method
</pre>
   <p>We can include directories in this listing:

<pre class="example">             % tla inventory --names --source --all --both
             ./hw.c
             ./main.c
             ./{arch}
             ./{arch}/.arch-project-tree
             ./{arch}/=tagging-method
             ./{arch}/hello-world
             ./{arch}/hello-world/hello-world--mainline
             [... output trimmed ...]
</pre>
   <p>We can also look at some lists of non-source files:

<pre class="example">             % tla inventory --names --backups
             ./hw.c.~1~
</pre>
   <p>The <code>inventory</code> command has many options that you may wish to explore.

<h4 class="subsection">3.6.5 Customizing the Naming Conventions</h4>

<p>You can alter the patterns used by <code>inventory</code> to classify files. 
This is explained in a later chapter (see <a href="Customizing-the-inventory-Naming-Conventions.html#Customizing-the-inventory-Naming-Conventions">Customizing the inventory Naming Conventions</a>).

<h4 class="subsection">3.6.6 Why is It Like This &ndash; inventory Naming Conventions</h4>

<p>Many systems provide naming conventions for recognizing source files
but users new to <code>arch</code> often wonder why <code>arch</code> needs so many
categories of files.   Recall that <code>arch</code> has the categories:

<pre class="example">             excluded
             source
             precious
             junk
             backups
             unrecognized
</pre>
   <p>A rationale for each category is explained here:

   <p><strong>excluded</strong> is provided simply to keep inventory listings brief in the
very common case that <code>arch</code> control files are of no particular
interest.  This is similar to the treatment of "dot files" by <code>ls</code>
and the <code>--all</code> flag to <code>inventory</code> is similar to the <code>-a</code> flag to
<code>ls</code>.

   <p><strong>source</strong> is provides simply so that <code>arch</code> can reliably distinguish
those files from others.  For example, when comparing two source
trees, <code>arch</code> compares only the files in the category <code>source</code>.

   <p><strong>precious</strong> files are those that <code>arch</code> should make an effort to
preserve.  For example, if <code>arch</code> needs to make a copy of a project
tree for you, it copies the <code>precious</code> files along with the <code>source</code>. 
Suppose, for example, that you are taking notes while working on
source.   You don't want your file of notes to be mistaken for source,
but you also don't want them to be lost.   A useful trick is to give the
file a <code>precious</code> name (e.g. <code>+notes</code>).

   <p><strong>junk</strong> Often when working on a project tree, it's convenient to create
"throw-away" files.   You might want to compile a quick test program
or save, for the moment, the output of some command.   When enough of
these throw-away files have accumulated, it's handy to be able to get
rid of them all-at-once, without having to carefully identify which
files to toss, and which to keep.   <code>junk</code> names are perfect for this. 
When you create one of these throw-away files, give it name like
<code>,foo</code>.   Later, you can feel confident and safe issuing commands
like:

<pre class="example">
             % rm ,*

             % find . -name ',*' | xargs rm

             % tla inventory --junk | xargs rm

</pre>
   <p>From arch's perspective, junk files have two important properties. 
First, when copying a tree, the junk files are <em>not</em> copied.  Second,
it is considered safe for arch to overwrite a junk file.   In
practice, arch will only ever actually overwrite a junk file if that
junk file has a name that begins with <code>,,</code>.

   <p><strong>backups</strong> Editor backup files and the backup files created by programs
like <code>patch</code> often deserve special treatment.   For example, if your
editor creates "numbered backups", those are <em>almost</em> junk files,
but rather than deleting all of them, you might want to delete only
some of them.

   <p>For arch, what is important is that when copying a tree, backup files
should not also be copied.   For users, what is hopefully most useful
is that using the trick:

<pre class="example">             % tla inventory --junk | xargs rm
</pre>
   <p class="noindent">will not delete backup files.

   <p><strong>unrecognized</strong> The appearance in a source tree of a file that doesn't
fit any known pattern (or that has a suspicious name) most likely
indicates that something has gone wrong.   Rather than silently
ignoring such files or treating them as <code>precious</code> or <code>junk</code>, <code>arch</code>
explicitly flags these exceptions in order to be able to give
warnings to users.

   <p>Overall, adopting file naming conventions is a discipline that many
programmers may not be accustomed to, but it's one I strongly
recommend.  It's easy to stick to these conventions and tools like
<code>inventory</code> and <code>tree-lint</code> (introduced later) help you to keep your
source from get out of control.

   </body></html>

