<html>
<head>
<title>Project Tree Inventories</title>
</head>
<body>

<a name="Project_Tree_Inventories"></a>

<a href="http://www.regexps.com">The Hackerlab at <code>regexps.com</code></a>

<h2 align=center>Project Tree Inventories</h2>




<small>
<b>up: </b><a href="arch.html#arch_Meets_hello-world">arch Meets hello-world</a></br>
<b>next: </b><a href="inventory-ids.html#Inventory_Ids_for_Source">Inventory Ids for Source</a></br>

<b>prev: </b><a href="new-source.html#Starting_a_New_Source_Tree">Starting a New Source Tree</a></br>

</small>
<br>






<p><strong><u>Caution: Steep Learning Curve:</u></strong>  The concepts and commands introduced
in this chapter are likely to be unfamiliar to you, even if you have 
used other revision control systems.   They're really quite simple
once you get over the initial learning hurdle -- and after that
they're very useful.
</p><hr>

<a name="The_Name-based_inventory_Concept"></a>



<h3 align=center>The Name-based inventory Concept</h3>










<p>In a project tree, some of the files and directories are &quot;part of
the source&quot; -- they are of interest to <code>arch</code>
.  Other files and
directories may be scratch files, editor back-up files, and temporary
or intermediate files generated by programs.  Those other files should
be ignored or treated specially by most <code>arch</code>
 commands.
</p><p>This chapter discusses how <code>arch</code>
 recognizes which files to pay
attention to, and which to ignore.
</p><ul>
<li><a href="inventories.html#The_Name-based_inventory_Concept">The Name-based inventory Concept</a></li>
<li><a href="inventories.html#The_inventory_Command">The inventory Command</a></li>
<li><a href="inventories.html#The_arch_Naming_Conventions">The arch Naming Conventions</a></li>
<li><a href="inventories.html#Naming_Conventions_Illustrated">Naming Conventions Illustrated</a></li>
<li><a href="inventories.html#Customizing_the_Naming_Conventions">Customizing the Naming Conventions</a></li>
<li><a href="inventories.html#Why_is_It_Like_This_--_inventory_Naming_Conventions">Why is It Like This -- inventory Naming Conventions</a></li>
</ul>












<hr>

<a name="The_inventory_Command"></a>



<h3 align=center>The inventory Command</h3>




<small>
<b>up: </b><a href="inventories.html#Project_Tree_Inventories">Project Tree Inventories</a></br>
<b>next: </b><a href="inventories.html#The_arch_Naming_Conventions">The arch Naming Conventions</a></br>

<b>prev: </b><a href="inventories.html#The_Name-based_inventory_Concept">The Name-based inventory Concept</a></br>

</small>
<br>






<p><a name="index-pt:0"></a>

</p><p>The command <code>tla inventory --names --source</code>
 is used to print a list
of source files as determined by the naming conventions.  It has many
options, including options to print other kinds of file lists (such as
a list of all editor backup files, or a list of all files which are
not source).
</p><p>Let's suppose that after some editing, our source tree looks like
this:
</p><pre>
        % ls
        hw.c            hw.c.~1~        main.c          {arch}

</pre>
<p>The file <code>hw.c.~1~</code>
 is an editor backup file. <code>tla</code>
 knows that
and omits that file from the source inventory:
</p><pre>
        % tla inventory --names --source
        ./hw.c
        ./main.c

</pre>
<p><code>tla</code>
 can give you other lists besides lists of source:
</p><pre>
        % tla inventory --names --backups
        ./hw.c.~1~

</pre>











<hr>

<a name="The_arch_Naming_Conventions"></a>



<h3 align=center>The arch Naming Conventions</h3>




<small>
<b>up: </b><a href="inventories.html#Project_Tree_Inventories">Project Tree Inventories</a></br>
<b>next: </b><a href="inventories.html#Naming_Conventions_Illustrated">Naming Conventions Illustrated</a></br>

<b>prev: </b><a href="inventories.html#The_inventory_Command">The inventory Command</a></br>

</small>
<br>






<p><a name="index-pt:1"></a>

</p><p>This section describes the default naming conventions used by <code>arch</code>

to pick out source files from other kinds of files.  A later chapter
describes how to customize these conventions for a partiuclar tree
(see <a href="naming-conventions.html#Customizing_the_inventory_Naming_Conventions">Customizing the inventory Naming Conventions</a>).
</p><p>The naming conventions are based on several categories of files:
</p><pre>

        . and ..                These are simply ignored by arch

        excluded                Excluded files are normally omitted
                                from a listing, but if the `--all'
                                flag is passed to `inventory', 
                                then these files are put into 
                                one of the categories below and
                                included in the listing.

        source                  These are apparent source files

        precious                These are non-source files that 
                                should not be automatically deleted

        junk                    These are non-source files that
                                may be automatically deleted

        backups                 These are non-source files that
                                may be automatically deleted, but
                                any program that deletes them should
                                treat them as editor backup files
                                (e.g., keep the oldest and newest
                                of them)

        unrecognized            These are files that arch doesn't
                                know how to classify -- they fit
                                none of the naming conventions or
                                that have names that appear to
                                be &quot;suspicious&quot;.


</pre>
<p>The algorithm for classifying files by name has several rules.  For 
each file name, each of these rules is checked in the order listed
here until the first rule is reached that classifies the file.
</p><p><strong><u>Exclude Dot Files</u></strong>  The special files <code>.</code>
 and <code>..</code>
 are always 
excluded from inventory listings.
</p><p><strong><u>Non-portable Names are Unrecognized</u></strong>  File names containing
whitespace, non-printing characters, or a &quot;globbing character&quot; are
always classified as <code>unrecognized</code>
.   The globbing characters 
are:
</p><pre>
        ? [ ] * \

</pre>
<p><strong><u>Excluded File Test</u></strong> If the <code>--all</code>
 flag is <em>not</em> given to
<code>inventory</code>
, the file names matching the pattern for excluded files
are dropped from the listing.  If the name of a directory is excluded,
the entire contents of that directory are skipped.  By default, the
pattern for excluded files matches control files created by <code>arch</code>

itself:
</p><pre>
        ^(.arch-ids|\{arch\})$

</pre>
<p><strong><u>Junk File Test</u></strong> All file names reaching this step that begin with two
commas (<code>,,</code>
) are classified as <code>junk</code>
.  Temporary files created by
<code>arch</code>
 itself begin with two commas.  In addition, any file name
matching the junk pattern are classified by <code>junk</code>
.  By default, that
pattern matches any name beginning with (at least) one comma:
</p><pre>
        ^,.*$

</pre>
<p>Incidentally, that default pattern gives rise to a handy trick.  If you
need to create a scratch file in a source tree, give it a name that
begins with a single comma.
</p><p><strong><u>Backup File Test</u></strong> By default, a backup file is any file that reaches this
step and matches one of the patterns:
</p><pre>
        ^.*(~|\.~[0-9]+~)$
        ^.*\.bak|\.orig|\.rej|\.original|\.modified|\.reject)$

</pre>
<p><strong><u>Precious File Test</u></strong> By default, a precious file is any that reaches this
step and matches one of the patterns:
</p><pre>
     ^\+.*$
     ^(\.gdbinit|\.#ckpts-lock)$
     ^(=build\.*|=install\.*)$
     ^(CVS|CVS\.adm|RCS|RCSLOG|SCCS|TAGS)$

</pre>
<p><strong><u>Suspicious File Test (Unrecognized)</u></strong> Some file names reaching this step
are explicitly treated as <code>unrecognized</code>
 on the presumption that they
should probably not be present in a source tree.  By default, names
ending with any of these extensions are treated as <code>unrecognized</code>
:
</p><pre>
        .o
        .a
        .so
        .core

</pre>
<p>In addition, the filename <code>core</code>
 is (by default) treated as
<code>unrecognized</code>
).
</p><p><strong><u>Source File Test</u></strong> Files reaching this step are compared to the pattern
for source files.   The default pattern is shown below.  You should
note that this pattern overlaps that for <code>excluded</code>
 files given
above.  If the <code>--all</code>
 flag is given to inventory, the <code>excluded</code>

pattern isn't used, and files that would match it instead &quot;fall
through&quot; to later steps of this algorithm.
</p><pre>
        ^([_=a-zA-Z0-9].*|\.arch-ids|\{arch\}|\.arch-project-tree)$

</pre>
<p>In other words, by default, the <code>arch</code>
 control files and directories
are source (if not excluded).  Files beginning with letters, numbers, 
underscore, or an equal sign are source.
</p><p><strong><u>Unrecognized Files</u></strong> Any left-over file name reaching this step is 
treated as <code>unrecognized</code>
.
</p>










<hr>

<a name="Naming_Conventions_Illustrated"></a>



<h3 align=center>Naming Conventions Illustrated</h3>




<small>
<b>up: </b><a href="inventories.html#Project_Tree_Inventories">Project Tree Inventories</a></br>
<b>next: </b><a href="inventories.html#Customizing_the_Naming_Conventions">Customizing the Naming Conventions</a></br>

<b>prev: </b><a href="inventories.html#The_arch_Naming_Conventions">The arch Naming Conventions</a></br>

</small>
<br>






<p>Using our example, we can illustrate some of the naming conventions.
</p><p>Recall that our project tree looks like this:
</p><pre>
        % ls
        hw.c            hw.c.~1~        main.c          {arch}

</pre>
<p>So the ordinary source listing is:
</p><pre>
        % tla inventory --names --source
        ./hw.c
        ./main.c

</pre>
<p>And all of the source files (none excluded from the list) is:
</p><pre>
        % tla inventory --names --source --all
        ./hw.c
        ./main.c
        ./{arch}/.arch-project-tree
        ./{arch}/=tagging-method

</pre>
<p>We can include directories in this listing:
</p><pre>
        % tla inventory --names --source --all --both
        ./hw.c
        ./main.c
        ./{arch}
        ./{arch}/.arch-project-tree
        ./{arch}/=tagging-method
        ./{arch}/hello-world
        ./{arch}/hello-world/hello-world--mainline
        [... output trimmed ...]

</pre>
<p>We can also look at some lists of non-source files:
</p><pre>
        % tla inventory --names --backups
        ./hw.c.~1~

</pre>
<p>The <code>inventory</code>
 command has many options that you may wish to explore.
</p>










<hr>

<a name="Customizing_the_Naming_Conventions"></a>



<h3 align=center>Customizing the Naming Conventions</h3>




<small>
<b>up: </b><a href="inventories.html#Project_Tree_Inventories">Project Tree Inventories</a></br>
<b>next: </b><a href="inventories.html#Why_is_It_Like_This_--_inventory_Naming_Conventions">Why is It Like This -- inventory Naming Conventions</a></br>

<b>prev: </b><a href="inventories.html#Naming_Conventions_Illustrated">Naming Conventions Illustrated</a></br>

</small>
<br>






<p>You can alter the patterns used by <code>inventory</code>
 to classify files.
This is explained in a later chapter (see <a href="naming-conventions.html#Customizing_the_inventory_Naming_Conventions">Customizing the inventory Naming Conventions</a>).
</p>










<hr>

<a name="Why_is_It_Like_This_--_inventory_Naming_Conventions"></a>



<h3 align=center>Why is It Like This -- inventory Naming Conventions</h3>




<small>
<b>up: </b><a href="inventories.html#Project_Tree_Inventories">Project Tree Inventories</a></br>

<b>prev: </b><a href="inventories.html#Customizing_the_Naming_Conventions">Customizing the Naming Conventions</a></br>

</small>
<br>






<p>Many systems provide naming conventions for recognizing source files
but users new to <code>arch</code>
 often wonder why <code>arch</code>
 needs so many
categories of files.   Recall that <code>arch</code>
 has the categories:
</p><pre>
        excluded
        source
        precious
        junk
        backups
        unrecognized

</pre>
<p>A rationale for each category is explained here:
</p><p><strong><u>excluded</u></strong> is provided simply to keep inventory listings brief in the
very common case that <code>arch</code>
 control files are of no particular
interest.  This is similar to the treatment of &quot;dot files&quot; by <code>ls</code>

and the <code>--all</code>
 flag to <code>inventory</code>
 is similar to the <code>-a</code>
 flag to
<code>ls</code>
.
</p><p><strong><u>source</u></strong> is provides simply so that <code>arch</code>
 can reliably distinguish
those files from others.  For example, when comparing two source
trees, <code>arch</code>
 compares only the files in the category <code>source</code>
.
</p><p><strong><u>precious</u></strong> files are those that <code>arch</code>
 should make an effort to
preserve.  For example, if <code>arch</code>
 needs to make a copy of a project
tree for you, it copies the <code>precious</code>
 files along with the <code>source</code>
.
Suppose, for example, that you are taking notes while working on
source.   You don't want your file of notes to be mistaken for source,
but you also don't want them to be lost.   A useful trick is to give the
file a <code>precious</code>
 name (e.g. <code>+notes</code>
).
</p><p><strong><u>junk</u></strong> Often when working on a project tree, it's convenient to create
&quot;throw-away&quot; files.   You might want to compile a quick test program
or save, for the moment, the output of some command.   When enough of
these throw-away files have accumulated, it's handy to be able to get
rid of them all-at-once, without having to carefully identify which
files to toss, and which to keep.   <code>junk</code>
 names are perfect for this.   
When you create one of these throw-away files, give it name like
<code>,foo</code>
.   Later, you can feel confident and safe issuing commands
like:
</p><pre>

        % rm ,*

        % find . -name ',*' | xargs rm

        % tla inventory --junk | xargs rm


</pre>
<p>From arch's perspective, junk files have two important properties.
First, when copying a tree, the junk files are <em>not</em> copied.  Second,
it is considered safe for arch to overwrite a junk file.   In
practice, arch will only ever actually overwrite a junk file if that
junk file has a name that begins with <code>,,</code>
.
</p><p><strong><u>backups</u></strong> Editor backup files and the backup files created by programs
like <code>patch</code>
 often deserve special treatment.   For example, if your
editor creates &quot;numbered backups&quot;, those are <em>almost</em> junk files,
but rather than deleting all of them, you might want to delete only
some of them.
</p><p>For arch, what is important is that when copying a tree, backup files
should not also be copied.   For users, what is hopefully most useful
is that using the trick:
</p><pre>
        % tla inventory --junk | xargs rm

</pre>
<p>will not delete backup files.
</p><p><strong><u>unrecognized</u></strong> The appearance in a source tree of a file that doesn't
fit any known pattern (or that has a suspicious name) most likely 
indicates that something has gone wrong.   Rather than silently
ignoring such files or treating them as <code>precious</code>
 or <code>junk</code>
, <code>arch</code>
 
explicitly flags these exceptions in order to be able to give 
warnings to users.
</p><p>Overall, adopting file naming conventions is a discipline that many
programmers may not be accustomed to, but it's one I strongly
recommend.  It's easy to stick to these conventions and tools like
<code>inventory</code>
 and <code>tree-lint</code>
 (introduced later) help you to keep your
source from get out of control.
</p>


















<small><i>arch Meets hello-world: A Tutorial Introduction to The arch Revision Control System

</i></small><br>


<a href="http://www.regexps.com">The Hackerlab at <code>regexps.com</code></a>

</body>
